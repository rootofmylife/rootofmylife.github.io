# WebAuthn

You will see [WebAuthn](https://en.wikipedia.org/wiki/WebAuthn) when browser asks you to use fingerprint or face recognition to login to a website. It is a standard for passwordless authentication on the web.

## How it works

WenAuthn has 2 main operations:

- Registration
- Authentication

### Registration

This happens when a user signs up for a website. The user will be asked to generate a private-public key pair. The private key is stored on the device and the public key is sent to the server.

#### Verify browser support

```javascript
var canUseWebAuthn =
  await PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable();
```

The `canUseWebAuthn` will be `true` if the browser supports WebAuthn.

### Authentication

This happens when a user logs in to a website. The user will be asked to sign a challenge with the private key. The server will verify the signature with the public key.

The challenge is a random string generated by the server. It is used to prevent replay attacks.

#### Protocol

- The protocol can be `U2F` or `CTAP2`. `CTAP2` is the latest version.
- The `U2F` protocol is used for older devices.

#### Transport

- The transport can be `usb`, `nfc`, or `ble`, `calble`, `internal`.

## Testing

Here is a simple example to test WebAuthn.

```js
import { chromium } from "playwright";

const browser = await chromium.launch({ headless: false });

const context = await browser.newContext();

const page = await context.newPage();

const CDPSession = await page.context().newCDPSession(page);
await CDPSession.send("WebAuthn.enable");

await CDPSession.send("WebAuthn.addVirtualAuthenticator", {
  options: {
    protocol: "ctap2",
    transport: "internal",
    hasResidentKey: true,
    hasUserVerification: true,
    isUserVerified: true,
  },
});

await page.goto("https://webauthn.io/");

const randomString = Math.random().toString(36).substring(7);

// 3. Interact with the page as usual
await page.getByPlaceholder("example_username").fill(`user_${randomString}`);
await page
  .getByText("Register", { exact: true })
  .and(page.locator("button"))
  .click();
```

## References

- [MDN](https://developer.mozilla.org/en-US/docs/Web/API/Web_Authentication_API)
- [heal.dev](https://www.heal.dev/docs/blog/testing-webauthn)
